{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 80f07c22447e56ac2a67","webpack:///./~/jssha/src/sha1.js","webpack:///external {\"commonjs\":\"dzhyun-connection\",\"commonjs2\":\"dzhyun-connection\",\"amd\":\"dzhyun-connection\",\"root\":\"connection\"}","webpack:///./src/DzhyunTokenManager.js"],"names":["oneDayDuration","tokenAccessServiceUrl","InternalTokenManager","address","appid","secret_key","shortid","getToken","duration","_promise","Promise","resolve","getCacheToken","catch","generateToken","access","then","token","_token","reject","expiredTime","parseInt","Date","now","rawMask","shaObj","JSSHA","setHMACKey","update","hexMask","getHMAC","join","DzhyunConnection","dataType","response","result","Err","err","Error","Data","desc","code","RepDataToken","error","request","expireTime","split","DzhyunTokenManager","tokenManager","module","exports"],"mappings":"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","file":"dzhyun-token.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"dzhyun-connection\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"dzhyun-connection\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DzhyunTokenManager\"] = factory(require(\"dzhyun-connection\"));\n\telse\n\t\troot[\"DzhyunTokenManager\"] = factory(root[\"connection\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 80f07c22447e56ac2a67","/*\n A JavaScript implementation of the SHA family of hashes, as\n defined in FIPS PUB 180-4 and FIPS PUB 202, as well as the corresponding\n HMAC implementation as defined in FIPS PUB 198a\n\n Copyright Brian Turek 2008-2017\n Distributed under the BSD License\n See http://caligatio.github.com/jsSHA/ for more information\n\n Several functions taken from Paul Johnston\n*/\n'use strict';(function(G){function r(d,b,c){var h=0,a=[],f=0,g,m,k,e,l,p,q,t,w=!1,n=[],u=[],v,r=!1;c=c||{};g=c.encoding||\"UTF8\";v=c.numRounds||1;if(v!==parseInt(v,10)||1>v)throw Error(\"numRounds must a integer >= 1\");if(\"SHA-1\"===d)l=512,p=z,q=H,e=160,t=function(a){return a.slice()};else throw Error(\"Chosen SHA variant is not supported\");k=A(b,g);m=x(d);this.setHMACKey=function(a,f,b){var c;if(!0===w)throw Error(\"HMAC key already set\");if(!0===r)throw Error(\"Cannot set HMAC key after calling update\");\ng=(b||{}).encoding||\"UTF8\";f=A(f,g)(a);a=f.binLen;f=f.value;c=l>>>3;b=c/4-1;if(c<a/8){for(f=q(f,a,0,x(d),e);f.length<=b;)f.push(0);f[b]&=4294967040}else if(c>a/8){for(;f.length<=b;)f.push(0);f[b]&=4294967040}for(a=0;a<=b;a+=1)n[a]=f[a]^909522486,u[a]=f[a]^1549556828;m=p(n,m);h=l;w=!0};this.update=function(b){var e,g,c,d=0,q=l>>>5;e=k(b,a,f);b=e.binLen;g=e.value;e=b>>>5;for(c=0;c<e;c+=q)d+l<=b&&(m=p(g.slice(c,c+q),m),d+=l);h+=d;a=g.slice(d>>>5);f=b%l;r=!0};this.getHash=function(b,g){var c,k,l,p;if(!0===\nw)throw Error(\"Cannot call getHash after setting HMAC key\");l=B(g);switch(b){case \"HEX\":c=function(a){return C(a,e,l)};break;case \"B64\":c=function(a){return D(a,e,l)};break;case \"BYTES\":c=function(a){return E(a,e)};break;case \"ARRAYBUFFER\":try{k=new ArrayBuffer(0)}catch(I){throw Error(\"ARRAYBUFFER not supported by this environment\");}c=function(a){return F(a,e)};break;default:throw Error(\"format must be HEX, B64, BYTES, or ARRAYBUFFER\");}p=q(a.slice(),f,h,t(m),e);for(k=1;k<v;k+=1)p=q(p,e,0,x(d),e);\nreturn c(p)};this.getHMAC=function(b,g){var c,k,n,r;if(!1===w)throw Error(\"Cannot call getHMAC without first setting HMAC key\");n=B(g);switch(b){case \"HEX\":c=function(a){return C(a,e,n)};break;case \"B64\":c=function(a){return D(a,e,n)};break;case \"BYTES\":c=function(a){return E(a,e)};break;case \"ARRAYBUFFER\":try{c=new ArrayBuffer(0)}catch(I){throw Error(\"ARRAYBUFFER not supported by this environment\");}c=function(a){return F(a,e)};break;default:throw Error(\"outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER\");\n}k=q(a.slice(),f,h,t(m),e);r=p(u,x(d));r=q(k,e,l,r,e);return c(r)}}function C(d,b,c){var h=\"\";b/=8;var a,f;for(a=0;a<b;a+=1)f=d[a>>>2]>>>8*(3+a%4*-1),h+=\"0123456789abcdef\".charAt(f>>>4&15)+\"0123456789abcdef\".charAt(f&15);return c.outputUpper?h.toUpperCase():h}function D(d,b,c){var h=\"\",a=b/8,f,g,m;for(f=0;f<a;f+=3)for(g=f+1<a?d[f+1>>>2]:0,m=f+2<a?d[f+2>>>2]:0,m=(d[f>>>2]>>>8*(3+f%4*-1)&255)<<16|(g>>>8*(3+(f+1)%4*-1)&255)<<8|m>>>8*(3+(f+2)%4*-1)&255,g=0;4>g;g+=1)8*f+6*g<=b?h+=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".charAt(m>>>\n6*(3-g)&63):h+=c.b64Pad;return h}function E(d,b){var c=\"\",h=b/8,a,f;for(a=0;a<h;a+=1)f=d[a>>>2]>>>8*(3+a%4*-1)&255,c+=String.fromCharCode(f);return c}function F(d,b){var c=b/8,h,a=new ArrayBuffer(c),f;f=new Uint8Array(a);for(h=0;h<c;h+=1)f[h]=d[h>>>2]>>>8*(3+h%4*-1)&255;return a}function B(d){var b={outputUpper:!1,b64Pad:\"=\",shakeLen:-1};d=d||{};b.outputUpper=d.outputUpper||!1;!0===d.hasOwnProperty(\"b64Pad\")&&(b.b64Pad=d.b64Pad);if(\"boolean\"!==typeof b.outputUpper)throw Error(\"Invalid outputUpper formatting option\");\nif(\"string\"!==typeof b.b64Pad)throw Error(\"Invalid b64Pad formatting option\");return b}function A(d,b){var c;switch(b){case \"UTF8\":case \"UTF16BE\":case \"UTF16LE\":break;default:throw Error(\"encoding must be UTF8, UTF16BE, or UTF16LE\");}switch(d){case \"HEX\":c=function(b,a,f){var g=b.length,c,d,e,l,p;if(0!==g%2)throw Error(\"String of HEX type must be in byte increments\");a=a||[0];f=f||0;p=f>>>3;for(c=0;c<g;c+=2){d=parseInt(b.substr(c,2),16);if(isNaN(d))throw Error(\"String of HEX type contains invalid characters\");\nl=(c>>>1)+p;for(e=l>>>2;a.length<=e;)a.push(0);a[e]|=d<<8*(3+l%4*-1)}return{value:a,binLen:4*g+f}};break;case \"TEXT\":c=function(c,a,f){var g,d,k=0,e,l,p,q,t,n;a=a||[0];f=f||0;p=f>>>3;if(\"UTF8\"===b)for(n=3,e=0;e<c.length;e+=1)for(g=c.charCodeAt(e),d=[],128>g?d.push(g):2048>g?(d.push(192|g>>>6),d.push(128|g&63)):55296>g||57344<=g?d.push(224|g>>>12,128|g>>>6&63,128|g&63):(e+=1,g=65536+((g&1023)<<10|c.charCodeAt(e)&1023),d.push(240|g>>>18,128|g>>>12&63,128|g>>>6&63,128|g&63)),l=0;l<d.length;l+=1){t=k+\np;for(q=t>>>2;a.length<=q;)a.push(0);a[q]|=d[l]<<8*(n+t%4*-1);k+=1}else if(\"UTF16BE\"===b||\"UTF16LE\"===b)for(n=2,d=\"UTF16LE\"===b&&!0||\"UTF16LE\"!==b&&!1,e=0;e<c.length;e+=1){g=c.charCodeAt(e);!0===d&&(l=g&255,g=l<<8|g>>>8);t=k+p;for(q=t>>>2;a.length<=q;)a.push(0);a[q]|=g<<8*(n+t%4*-1);k+=2}return{value:a,binLen:8*k+f}};break;case \"B64\":c=function(b,a,f){var c=0,d,k,e,l,p,q,n;if(-1===b.search(/^[a-zA-Z0-9=+\\/]+$/))throw Error(\"Invalid character in base-64 string\");k=b.indexOf(\"=\");b=b.replace(/\\=/g,\n\"\");if(-1!==k&&k<b.length)throw Error(\"Invalid '=' found in base-64 string\");a=a||[0];f=f||0;q=f>>>3;for(k=0;k<b.length;k+=4){p=b.substr(k,4);for(e=l=0;e<p.length;e+=1)d=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".indexOf(p[e]),l|=d<<18-6*e;for(e=0;e<p.length-1;e+=1){n=c+q;for(d=n>>>2;a.length<=d;)a.push(0);a[d]|=(l>>>16-8*e&255)<<8*(3+n%4*-1);c+=1}}return{value:a,binLen:8*c+f}};break;case \"BYTES\":c=function(b,a,c){var d,m,k,e,l;a=a||[0];c=c||0;k=c>>>3;for(m=0;m<b.length;m+=\n1)d=b.charCodeAt(m),l=m+k,e=l>>>2,a.length<=e&&a.push(0),a[e]|=d<<8*(3+l%4*-1);return{value:a,binLen:8*b.length+c}};break;case \"ARRAYBUFFER\":try{c=new ArrayBuffer(0)}catch(h){throw Error(\"ARRAYBUFFER not supported by this environment\");}c=function(b,a,c){var d,m,k,e,l;a=a||[0];c=c||0;m=c>>>3;l=new Uint8Array(b);for(d=0;d<b.byteLength;d+=1)e=d+m,k=e>>>2,a.length<=k&&a.push(0),a[k]|=l[d]<<8*(3+e%4*-1);return{value:a,binLen:8*b.byteLength+c}};break;default:throw Error(\"format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER\");\n}return c}function n(d,b){return d<<b|d>>>32-b}function u(d,b){var c=(d&65535)+(b&65535);return((d>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function y(d,b,c,h,a){var f=(d&65535)+(b&65535)+(c&65535)+(h&65535)+(a&65535);return((d>>>16)+(b>>>16)+(c>>>16)+(h>>>16)+(a>>>16)+(f>>>16)&65535)<<16|f&65535}function x(d){var b=[];if(\"SHA-1\"===d)b=[1732584193,4023233417,2562383102,271733878,3285377520];else throw Error(\"No SHA variants supported\");return b}function z(d,b){var c=[],h,a,f,g,m,k,e;h=b[0];a=b[1];\nf=b[2];g=b[3];m=b[4];for(e=0;80>e;e+=1)c[e]=16>e?d[e]:n(c[e-3]^c[e-8]^c[e-14]^c[e-16],1),k=20>e?y(n(h,5),a&f^~a&g,m,1518500249,c[e]):40>e?y(n(h,5),a^f^g,m,1859775393,c[e]):60>e?y(n(h,5),a&f^a&g^f&g,m,2400959708,c[e]):y(n(h,5),a^f^g,m,3395469782,c[e]),m=g,g=f,f=n(a,30),a=h,h=k;b[0]=u(h,b[0]);b[1]=u(a,b[1]);b[2]=u(f,b[2]);b[3]=u(g,b[3]);b[4]=u(m,b[4]);return b}function H(d,b,c,h){var a;for(a=(b+65>>>9<<4)+15;d.length<=a;)d.push(0);d[b>>>5]|=128<<24-b%32;b+=c;d[a]=b&4294967295;d[a-1]=b/4294967296|0;\nb=d.length;for(a=0;a<b;a+=16)h=z(d.slice(a,a+16),h);return h}\"function\"===typeof define&&define.amd?define(function(){return r}):\"undefined\"!==typeof exports?(\"undefined\"!==typeof module&&module.exports&&(module.exports=r),exports=r):G.jsSHA=r})(this);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/jssha/src/sha1.js\n// module id = 0\n// module chunks = 0 1","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"dzhyun-connection\",\"commonjs2\":\"dzhyun-connection\",\"amd\":\"dzhyun-connection\",\"root\":\"connection\"}\n// module id = 1\n// module chunks = 0 1","/* eslint camelcase: 0 */\r\nimport DzhyunConnection from 'dzhyun-connection';\r\nimport JSSHA from 'jssha/src/sha1';\r\n\r\nconst oneDayDuration = 24 * 60 * 60;\r\nconst tokenAccessServiceUrl = '/token/access';\r\n\r\nclass InternalTokenManager {\r\n\r\n  constructor({ address, appid, secret_key, shortid }) {\r\n    this.address = address;\r\n    this.appid = appid;\r\n    this.secret_key = secret_key;\r\n    this.shortid = shortid;\r\n  }\r\n\r\n  getToken = (duration = oneDayDuration) => {\r\n    if (!this._promise) {\r\n\r\n      // 先判断如果有缓存的token，否则先尝试本地生成，失败则再尝试请求远程接口\r\n      this._promise = Promise.resolve(this.getCacheToken())\r\n      .catch(() => this.generateToken(duration))\r\n      .catch(() => this.access())\r\n      .then((token) => {\r\n        this._promise = null;\r\n        this._token = token;\r\n        return token;\r\n      });\r\n    }\r\n    return this._promise;\r\n  };\r\n\r\n  generateToken = (duration = oneDayDuration) => {\r\n    if (!this.appid || !this.secret_key || !this.shortid) {\r\n      return Promise.reject('缺少信息，无法生成token');\r\n    }\r\n    return new Promise((resolve) => {\r\n      const expiredTime = parseInt(Date.now() / 1000, 10) + duration;\r\n      const rawMask = `${this.appid}_${expiredTime}_${this.secret_key}`;\r\n      const shaObj = new JSSHA('SHA-1', 'TEXT');\r\n      shaObj.setHMACKey(this.secret_key, 'TEXT');\r\n      shaObj.update(rawMask);\r\n      const hexMask = shaObj.getHMAC('HEX');\r\n      const token = [this.shortid, expiredTime, hexMask].join(':');\r\n      resolve(token);\r\n    });\r\n  };\r\n\r\n  access() {\r\n    if (!this.address || !this.appid || !this.secret_key) {\r\n      return Promise.reject('缺少信息，无法请求token');\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      new DzhyunConnection(this.address, { dataType: 'json' }, {\r\n        response: (result) => {\r\n          if (result.Err !== 0) {\r\n            const err = new Error(result.Data.desc);\r\n            err.code = result.Data.code;\r\n            reject(err);\r\n          } else if (result.Data && result.Data.RepDataToken) {\r\n            resolve(result.Data.RepDataToken[0].token);\r\n          }\r\n        },\r\n        error: reject,\r\n      }).request(`${tokenAccessServiceUrl}?appid=${this.appid}&secret_key=${this.secret_key}`);\r\n    });\r\n  }\r\n\r\n  getCacheToken() {\r\n    return new Promise((resolve, reject) => {\r\n      if (this._token) {\r\n\r\n        // 判断保留的token是否过期\r\n        const expireTime = `${this._token.split(':')[1]}000`;\r\n        if (parseInt(expireTime, 10) > Date.now()) {\r\n          return resolve(this._token);\r\n        }\r\n      }\r\n      return reject();\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 云平台Token管理\r\n */\r\nexport default class DzhyunTokenManager {\r\n\r\n  /**\r\n   * @param {Object} param\r\n   * @param {string=} param.address 服务器地址\r\n   * @param {!string} param.appid\r\n   * @param {!string} param.secret_key\r\n   * @param {!string} param.shortid\r\n   */\r\n  constructor({ address, appid, secret_key, shortid } = {}) {\r\n    const tokenManager = new InternalTokenManager({ address, appid, secret_key, shortid });\r\n    this.getToken = tokenManager.getToken;\r\n    this.generateToken = tokenManager.generateToken;\r\n  }\r\n}\r\n\r\n// 避免 export default 导出的模块需要通过.default调用\r\nmodule.exports = DzhyunTokenManager;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DzhyunTokenManager.js"],"sourceRoot":""}